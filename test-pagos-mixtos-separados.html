<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Pagos Mixtos - Ingresos Separados</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-case {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }
        
        .before {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .after {
            background-color: #d1edff;
            border-left: 4px solid #0d6efd;
        }
        
        .correct {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .ingreso-usd {
            background-color: #e7f3ff;
            border-left: 4px solid #0066cc;
        }
        
        .ingreso-ves {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .highlight {
            font-weight: bold;
            color: #dc3545;
        }
        
        .highlight-correct {
            font-weight: bold;
            color: #28a745;
        }
        
        .badge-usd {
            background-color: #0066cc;
        }
        
        .badge-ves {
            background-color: #ffc107;
            color: #000;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h2><i class="bi bi-currency-exchange"></i> Test de Pagos Mixtos - Ingresos Separados</h2>
        <p>Esta página muestra cómo se procesan los pagos mixtos para generar 2 ingresos independientes.</p>
        
        <div class="alert alert-info">
            <h5><i class="bi bi-info-circle"></i> Nueva Lógica Implementada:</h5>
            <p>Los pagos mixtos ahora generan <strong>2 ingresos independientes</strong>: uno en USD y otro en VES, en lugar de un solo ingreso combinado.</p>
        </div>
        
        <h4>Ejemplo de Pago Mixto:</h4>
        
        <div class="test-case before">
            <h6><i class="bi bi-x-circle text-danger"></i> ANTES (Incorrecto):</h6>
            <div class="row">
                <div class="col-md-6">
                    <strong>Pedido:</strong> #63<br>
                    <strong>Cliente:</strong> Prueba<br>
                    <strong>Tipo:</strong> Pago Mixto<br>
                    <strong>Monto USD:</strong> <span class="highlight">$5.00</span><br>
                    <strong>Monto VES:</strong> <span class="highlight">990.96 Bs</span><br>
                    <strong>Método:</strong> MIXTO
                </div>
                <div class="col-md-6">
                    <p class="text-danger"><strong>❌ Problema:</strong> Un solo ingreso con ambos montos mezclados, dificulta el control de caja.</p>
                </div>
            </div>
        </div>
        
        <div class="test-case after">
            <h6><i class="bi bi-arrow-right text-primary"></i> DESPUÉS (Corregido):</h6>
            <div class="row">
                <div class="col-md-6">
                    <div class="ingreso-usd mb-2 p-2">
                        <strong>Ingreso #1:</strong><br>
                        <strong>ID:</strong> PED-63-USD<br>
                        <strong>Monto USD:</strong> <span class="highlight-correct">$5.00</span><br>
                        <strong>Monto VES:</strong> <span class="highlight-correct">-</span><br>
                        <strong>Método:</strong> Efectivo (USD)<br>
                        <strong>Tipo:</strong> <span class="badge bg-primary">Pago Mixto USD</span>
                    </div>
                    <div class="ingreso-ves p-2">
                        <strong>Ingreso #2:</strong><br>
                        <strong>ID:</strong> PED-63-VES<br>
                        <strong>Monto USD:</strong> <span class="highlight-correct">-</span><br>
                        <strong>Monto VES:</strong> <span class="highlight-correct">990.96 Bs</span><br>
                        <strong>Método:</strong> Pago Móvil (VES)<br>
                        <strong>Tipo:</strong> <span class="badge bg-warning">Pago Mixto VES</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <p class="text-success"><strong>✅ Beneficios:</strong></p>
                    <ul>
                        <li>Control de caja más preciso</li>
                        <li>Reportes separados por moneda</li>
                        <li>Referencias independientes</li>
                        <li>Mejor trazabilidad</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="test-case correct">
            <h6><i class="bi bi-check-circle text-success"></i> LÓGICA DE PROCESAMIENTO:</h6>
            <div class="row">
                <div class="col-md-12">
                    <h6>En el servicio de ingresos (ingresosService.js):</h6>
                    <pre><code>// Procesar pagos mixtos como ingresos separados
if (pedido.es_pago_mixto && pedido.monto_mixto_usd > 0 && pedido.monto_mixto_ves > 0) {
  // Ingreso en USD
  ingresosFormateados.push({
    id: `PED-${pedido.id}-USD`,
    montoUSD: pedido.monto_mixto_usd,
    montoVES: 0,
    metodoPago: pedido.metodo_pago_mixto_usd,
    tipoIngreso: 'Pago Mixto USD'
  })
  
  // Ingreso en VES
  ingresosFormateados.push({
    id: `PED-${pedido.id}-VES`,
    montoUSD: 0,
    montoVES: pedido.monto_mixto_ves,
    metodoPago: pedido.metodo_pago_mixto_ves,
    tipoIngreso: 'Pago Mixto VES'
  })
}</code></pre>
                </div>
            </div>
        </div>
        
        <h4>Tabla de Ingresos Resultante:</h4>
        
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Cliente</th>
                        <th>Monto USD</th>
                        <th>Monto VES</th>
                        <th>Método de Pago</th>
                        <th>Tipo de Ingreso</th>
                        <th>Referencia</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="table-primary">
                        <td><span class="badge badge-usd">PED-63-USD</span></td>
                        <td>Prueba</td>
                        <td class="text-success fw-bold">$5.00</td>
                        <td class="text-muted">-</td>
                        <td><span class="badge bg-success">Efectivo (USD)</span></td>
                        <td><span class="badge bg-primary">Pago Mixto USD</span></td>
                        <td>-</td>
                    </tr>
                    <tr class="table-warning">
                        <td><span class="badge badge-ves">PED-63-VES</span></td>
                        <td>Prueba</td>
                        <td class="text-muted">-</td>
                        <td class="text-info fw-bold">990.96 Bs</td>
                        <td><span class="badge bg-warning">Pago Móvil (VES)</span></td>
                        <td><span class="badge bg-warning">Pago Mixto VES</span></td>
                        <td>04141234567</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <h4>Tipos de Ingreso Correctos:</h4>
        
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0"><i class="bi bi-credit-card"></i> Pagos Completos</h6>
                    </div>
                    <div class="card-body">
                        <ul>
                            <li><span class="badge bg-success">Pago Completo de Contado</span> - Pago único en USD o VES</li>
                            <li><span class="badge bg-primary">Pago Mixto USD</span> - Parte USD de pago mixto</li>
                            <li><span class="badge bg-warning">Pago Mixto VES</span> - Parte VES de pago mixto</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h6 class="mb-0"><i class="bi bi-piggy-bank"></i> Abonos</h6>
                    </div>
                    <div class="card-body">
                        <ul>
                            <li><span class="badge bg-info">Abono Inicial</span> - Abono simple en USD o VES</li>
                            <li><span class="badge bg-primary">Abono Inicial USD</span> - Parte USD de abono mixto</li>
                            <li><span class="badge bg-warning">Abono Inicial VES</span> - Parte VES de abono mixto</li>
                            <li><span class="badge bg-secondary">Abono a Deuda</span> - Abonos posteriores</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <h4>Beneficios de la Nueva Implementación:</h4>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0"><i class="bi bi-cash-stack"></i> Control de Caja</h6>
                    </div>
                    <div class="card-body">
                        <ul>
                            <li>Separación clara entre USD y VES</li>
                            <li>Conteo independiente por moneda</li>
                            <li>Referencias específicas por método</li>
                            <li>Mejor trazabilidad</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0"><i class="bi bi-graph-up"></i> Reportes</h6>
                    </div>
                    <div class="card-body">
                        <ul>
                            <li>Reportes separados por moneda</li>
                            <li>Análisis de métodos de pago</li>
                            <li>Estadísticas más precisas</li>
                            <li>Mejor auditoría</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="alert alert-success">
            <h5><i class="bi bi-check-circle"></i> Resultado:</h5>
            <p>Los pagos mixtos ahora generan <strong>2 ingresos independientes</strong> que aparecen como filas separadas en la tabla de ingresos, facilitando el control de caja y los reportes.</p>
        </div>
        
        <div class="alert alert-warning">
            <h5><i class="bi bi-exclamation-triangle"></i> Nota Importante:</h5>
            <p>Esta implementación requiere que los datos en la base de datos tengan los campos <code>metodo_pago_mixto_usd</code> y <code>metodo_pago_mixto_ves</code> correctamente poblados.</p>
        </div>
    </div>
</body>
</html>
